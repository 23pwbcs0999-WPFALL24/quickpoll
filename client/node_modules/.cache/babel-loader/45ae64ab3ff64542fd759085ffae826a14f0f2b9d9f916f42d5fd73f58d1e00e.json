{"ast":null,"code":"import{useEffect,useState}from'react';import{useParams,Link}from'react-router-dom';import{getPoll}from'../services/api';import PollResults from'../components/PollResults';import'./PollResultsPage.css';import{io}from'socket.io-client';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SOCKET_URL=process.env.REACT_APP_BACKEND_URL||'http://localhost:5000';const PollResultsPage=()=>{var _poll$options,_poll$options2;const{id}=useParams();const[poll,setPoll]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState('');useEffect(()=>{let socket;const fetchPoll=async()=>{try{setLoading(true);setError('');const response=await getPoll(id);setPoll(response.data);}catch(err){var _err$response,_err$response2;if(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===404){setError('Poll not found. It may have been deleted or the link is incorrect.');}else if(((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.status)>=500){setError('Server error. Please try again later.');}else{setError('Failed to load poll results. Please check your connection and try again.');}}finally{setLoading(false);}};fetchPoll();// --- SOCKET.IO REAL-TIME ---\nsocket=io(SOCKET_URL);socket.emit('joinPoll',id);socket.on('voteUpdate',updatedPoll=>{setPoll(updatedPoll);});return()=>{if(socket)socket.disconnect();};},[id]);// Calculate total votes robustly\nconst totalVotes=poll===null||poll===void 0?void 0:(_poll$options=poll.options)===null||_poll$options===void 0?void 0:_poll$options.reduce((sum,opt)=>sum+(opt.votes||0),0);if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"results-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading poll results...\"})]})});}if(error||!poll){return/*#__PURE__*/_jsx(\"div\",{className:\"results-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"error-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"error-icon\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"Oops! Something went wrong\"}),/*#__PURE__*/_jsx(\"p\",{children:error||'Poll not found'}),/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"back-btn\",children:\"\\u2190 Back to Home\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"results-page\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"results-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Poll Results\"}),/*#__PURE__*/_jsx(\"p\",{className:\"poll-question\",children:poll.question}),/*#__PURE__*/_jsxs(\"div\",{className:\"poll-stats\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"stat\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-number\",children:totalVotes}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Total Votes\"})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"stat\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"stat-number\",children:((_poll$options2=poll.options)===null||_poll$options2===void 0?void 0:_poll$options2.length)||0}),/*#__PURE__*/_jsx(\"span\",{className:\"stat-label\",children:\"Options\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"results-content\",children:/*#__PURE__*/_jsx(PollResults,{options:poll.options,totalVotes:totalVotes})}),/*#__PURE__*/_jsxs(\"div\",{className:\"results-actions\",children:[/*#__PURE__*/_jsx(Link,{to:`/poll/${id}`,className:\"action-btn\",children:\"\\u2190 Back to Poll\"}),/*#__PURE__*/_jsx(Link,{to:\"/create\",className:\"action-btn primary\",children:\"Create New Poll\"})]})]});};export default PollResultsPage;","map":{"version":3,"names":["useEffect","useState","useParams","Link","getPoll","PollResults","io","jsx","_jsx","jsxs","_jsxs","SOCKET_URL","process","env","REACT_APP_BACKEND_URL","PollResultsPage","_poll$options","_poll$options2","id","poll","setPoll","loading","setLoading","error","setError","socket","fetchPoll","response","data","err","_err$response","_err$response2","status","emit","on","updatedPoll","disconnect","totalVotes","options","reduce","sum","opt","votes","className","children","to","question","length"],"sources":["C:/Users/user/Desktop/quickpoll/client/src/pages/PollResultsPage.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { useParams, Link } from 'react-router-dom';\r\nimport { getPoll } from '../services/api';\r\nimport PollResults from '../components/PollResults';\r\nimport './PollResultsPage.css';\r\nimport { io } from 'socket.io-client';\r\n\r\nconst SOCKET_URL = process.env.REACT_APP_BACKEND_URL || 'http://localhost:5000';\r\n\r\nconst PollResultsPage = () => {\r\n  const { id } = useParams();\r\n  const [poll, setPoll] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n\r\n  useEffect(() => {\r\n    let socket;\r\n    const fetchPoll = async () => {\r\n      try {\r\n        setLoading(true);\r\n        setError('');\r\n        const response = await getPoll(id);\r\n        setPoll(response.data);\r\n      } catch (err) {\r\n        if (err.response?.status === 404) {\r\n          setError('Poll not found. It may have been deleted or the link is incorrect.');\r\n        } else if (err.response?.status >= 500) {\r\n          setError('Server error. Please try again later.');\r\n        } else {\r\n          setError('Failed to load poll results. Please check your connection and try again.');\r\n        }\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchPoll();\r\n\r\n    // --- SOCKET.IO REAL-TIME ---\r\n    socket = io(SOCKET_URL);\r\n    socket.emit('joinPoll', id);\r\n    socket.on('voteUpdate', (updatedPoll) => {\r\n      setPoll(updatedPoll);\r\n    });\r\n\r\n    return () => {\r\n      if (socket) socket.disconnect();\r\n    };\r\n  }, [id]);\r\n\r\n  // Calculate total votes robustly\r\n  const totalVotes = poll?.options?.reduce((sum, opt) => sum + (opt.votes || 0), 0);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"results-page\">\r\n        <div className=\"loading-container\">\r\n          <div className=\"loading-spinner\"></div>\r\n          <p>Loading poll results...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error || !poll) {\r\n    return (\r\n      <div className=\"results-page\">\r\n        <div className=\"error-container\">\r\n          <div className=\"error-icon\">⚠️</div>\r\n          <h2>Oops! Something went wrong</h2>\r\n          <p>{error || 'Poll not found'}</p>\r\n          <Link to=\"/\" className=\"back-btn\">\r\n            ← Back to Home\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"results-page\">\r\n      <div className=\"results-header\">\r\n        <h1>Poll Results</h1>\r\n        <p className=\"poll-question\">{poll.question}</p>\r\n        <div className=\"poll-stats\">\r\n          <span className=\"stat\">\r\n            <span className=\"stat-number\">{totalVotes}</span>\r\n            <span className=\"stat-label\">Total Votes</span>\r\n          </span>\r\n          <span className=\"stat\">\r\n            <span className=\"stat-number\">{poll.options?.length || 0}</span>\r\n            <span className=\"stat-label\">Options</span>\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <div className=\"results-content\">\r\n        <PollResults options={poll.options} totalVotes={totalVotes} />\r\n      </div>\r\n      <div className=\"results-actions\">\r\n        <Link to={`/poll/${id}`} className=\"action-btn\">\r\n          ← Back to Poll\r\n        </Link>\r\n        <Link to=\"/create\" className=\"action-btn primary\">\r\n          Create New Poll\r\n        </Link>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PollResultsPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}